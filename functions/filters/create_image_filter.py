"""
title: Create an Image
id: create_image_filter
description: Injects the image_generation tool with configurable size and quality.
"""

from __future__ import annotations

from pydantic import BaseModel


class Filter:
    class Valves(BaseModel):
        SIZE: str = "auto"
        QUALITY: str = "auto"

    def __init__(self) -> None:
        self.valves = self.Valves()
        self.toggle = True
        self.icon = (
            "data:image/svg+xml;base64,"
            "PHN2ZyBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxwYXRoIGQ9Im0xNi45MDIgMi4zMDRjMC44MTg3LTAuNDI0MTYgMS43ODctMC4yMzI5OCAyLjQwNzIgMC4zODcxNyAwLjYyMDEgMC42MjAxNSAwLjgxMTMgMS41ODg1IDAuMzg3MiAyLjQwNzEtMC43ODY2IDEuNTE4MS0xLjcxOTMgMi44NDc5LTIuODQxNyA0LjA0MzUgMS4xMjg0IDEuNDAzMiAxLjk3NjQgMi44NTY4IDIuMzM0NiA0LjIyNDcgMC40MTc1IDEuNTk0MiAwLjE4MzQgMy4yMDE0LTEuMTk5NCA0LjMwNzctMS4xMTA3IDAuODg4NS0yLjM1ODggMC43Njg2LTMuMzU1NiAwLjM1NjktMC45NzAyLTAuNDAwOC0xLjgzMDctMS4xMTc2LTIuNDIxNC0xLjY4ODEtMC4zNjQxLTAuMzUxNy0wLjM3NDItMC45MzItMC4wMjI0LTEuMjk2MiAwLjM1MTctMC4zNjQxIDAuOTMyLTAuMzc0MiAxLjI5NjEgLTAuMDIyNSAwLjUzMiAwLjUxMzkgMS4xOTUgMS4wNDI3IDEuODQ3NyAxLjMxMjMgMC42MjYxIDAuMjU4NyAxLjEwMDQgMC4yMzM5IDEuNTEwMy0wLjA5NCAwLjY0NjktMC41MTc2IDAuODY3Ny0xLjI3OTQgMC41NzEyLTIuNDExNi0wLjI2MTItMC45OTc0LTAuOTEwOS0yLjE3MzgtMS44ODg1LTMuNDEzMi0wLjUzMjMgMC40NjMtMS4xMDA4IDAuOTA1OC0xLjcwODcgMS4zMzI1LTAuMDI3IDAuMDE5LTAuMDU0NiAwLjAzNjMtMC4wODI4IDAuMDUxOS0wLjA1NjggMC42NjY3LTAuMjgxMSAxLjIzNzEtMC42NzYgMS42OTE4LTAuNDQ5NSAwLjUxNzYtMS4wNDIyIDAuNzk1MS0xLjYwODcgMC45NDk1LTAuOTAzIDAuMjQ2MS0xLjk4MzkgMC4yMzAzLTIuNzcyNiAwLjIxODgtMC4xNTE3OC0wLjAwMjItMC4yOTI3NC0wLjAwNDMtMC40MTk1My0wLjAwNDMtMC41MDYyNiAwLTAuOTE2NjYtMC40MTA0LTAuOTE2NjYtMC45MTY2IDAtMC4xMjY4LTAuMDAyMDYtMC4yNjc4LTAuMDA0MjctMC40MTk1LTAuMDExNDktMC43ODg3LTAuMDI3MjUtMS44Njk2IDAuMjE4ODUtMi43NzI2IDAuMTU0MzktMC41NjY1MSAwLjQzMTg1LTEuMTU5MyAwLjk0OTQ1LTEuNjA4OCAwLjQ1NDY4LTAuMzk0ODcgMS4wMjUyLTAuNjE5MTQgMS42OTE5LTAuNjc1OTcgMC4wMTU2LTAuMDI4MTggMC4wMzI5LTAuMDU1ODMgMC4wNTE4LTAuMDgyOCAwLjM2NDQtMC41MTkxMSAwLjc0MDYtMS4wOTUgMS4xMzA5LTEuNDczMS0yLjY0OTYtMS40NTQzLTUuMTk3NS0xLjMzNTQtNi41MTktMC4wMTM4Ny0wLjg4NzExIDAuODg3MTEtMS4yMzc1IDIuMjg3NS0wLjkyMjgzIDMuOTY1NiAwLjMxMzY2IDEuNjcyOCAxLjI4MDUgMy41MjIgMi44Njc0IDUuMTA4OSAwLjkzNjg2IDAuOTM2OSAxLjk0OTEgMS41OTExIDIuNzc3MSAyLjAwOTEgMC40MTM1NCAwLjIwODggMC43NzM1OSAwLjM1NDggMS4wNDU3IDAuNDQ2NSAwLjIwMzcgMC4wNjg2IDAuMzIwNSAwLjA5MzkgMC4zNjM0IDAuMTAzMiAwLjAyMjYgMC4wMDQ5IDAuMDI0NiAwLjAwNTMgMC4wMDc4IDAuMDA1MyAwLjUwNjMgMCAwLjkxNjcgMC40MTA0IDAuOTE2NyAwLjkxNjdzLTAuNDEwNCAwLjkxNjctMC45MTY3IDAuOTE2NmMtMC4yNzc2IDAtMC42MzUtMC4wOTYxLTAuOTU2NC0wLjIwNDQtMC4zNjA4OC0wLjEyMTYtMC44MDEzLTAuMzAyMi0xLjI4NjctMC41NDczLTAuOTY5OS0wLjQ4OTYtMi4xNDk2LTEuMjUxNy0zLjI0NzMtMi4zNDkzLTEuODE0LTEuODE0LTIuOTgyOC0zLjk4NjgtMy4zNzI5LTYuMDY3NS0wLjM4OTE1LTIuMDc1NC0wLjAxMTM3LTQuMTYgMS40Mjg0LTUuNTk5OCAyLjI0ODktMi4yNDkgNS45Nzk1LTEuOTIyIDkuMDk5NzUtMC4wNjY0OSAxLjI0NTgtMS4yMDU5IDIuNjM3Ni0yLjE5ODIgNC4yMzg5LTMuMDI3OXptLTQuNzQ5IDYuMzc3NGMwLjQ4MjcgMC4yODAzNiAwLjg4NTYgMC42ODMxNyAxLjE2NTkgMS4xNjU5IDIuMDc1NC0xLjU2MzEgMy41ODUzLTMuMzQ1MiA0Ljc0OTYtNS41OTI1IDAuMDM2Mi0wLjA2OTgyIDAuMDMxNy0wLjE3OTk1LTAuMDU1Ny0wLjI2NzM3LTAuMDg3NC0wLjA4NzQxLTAuMTk3NS0wLjA5MTg5LTAuMjY3NC0wLjA1NTcyLTIuMjQ3MiAxLjE2NDQtNC4wMjkzIDIuNjc0My01LjU5MjQgNC43NDk2em0tMi45ODQ3IDQuMTUwN2MwLjY1NDYyIDAuMDAzNCAxLjI3MjUtMC4wMTM1IDEuODAwNy0wLjE1NzUgMC4zNTU5LTAuMDk3IDAuNTc1LTAuMjMxMSAwLjcwNjYtMC4zODI3IDAuMTE5Mi0wLjEzNzMgMC4yNDEzLTAuMzczNiAwLjI0MTMtMC44Mzc4IDAtMC43NTctMC42MTM2LTEuMzcwNy0xLjM3MDYtMS4zNzA3LTAuNDY0MiAwLTAuNzAwNTggMC4xMjIxLTAuODM3ODQgMC4yNDEzLTAuMTUxNiAwLjEzMTctMC4yODU3NSAwLjM1MDctMC4zODI3NiAwLjcwNjYtMC4xNDM5NSAwLjUyODMtMC4xNjA4OCAxLjE0NjEtMC4xNTc0MiAxLjgwMDh6Ii8+Cjwvc3ZnPg=="
        )

    def _add_image_generation_tool(self, body: dict) -> None:
        entry = {
            "type": "image_generation",
            "size": self.valves.SIZE,
            "quality": self.valves.QUALITY,
        }
        tools = body.setdefault("tools", [])
        if not any(t.get("type") == "image_generation" for t in tools):
            tools.append(entry)

    async def inlet(self, body: dict, **_kwargs) -> dict:
        self._add_image_generation_tool(body)
        return body
